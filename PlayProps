{{- if .Values.syslogCollector.enabled -}}
{{- range $i := until (int .Values.syslogCollector.instances) -}}
{{- $instanceIndex := add $i 1 -}}
{{- $instanceName := include "syslog-collector.instanceName" $instanceIndex -}}
{{- $instancePort := include "syslog-collector.instancePort" $instanceIndex -}}
---
apiVersion: v1
kind: Service
metadata:
  name: {{ $instanceName }}
  labels:
    {{- include "syslog-collector.labels" $instanceIndex | nindent 4 }}
spec:
  type: ClusterIP
  ports:
    - port: {{ $instancePort }}
      targetPort: syslog
      protocol: UDP
      name: syslog-udp
    - port: {{ $instancePort }}
      targetPort: syslog-tcp
      protocol: TCP
      name: syslog-tcp
    - port: 9102
      targetPort: metrics
      protocol: TCP
      name: metrics
  selector:
    {{- include "syslog-collector.selectorLabels" $instanceIndex | nindent 4 }}
{{- end }}
{{- end }}
