[Unit]
Description=Syslog Collector Container
After=network.target
Requires=network.target

[Service]
Type=exec
Restart=always
RestartSec=5
TimeoutStartSec=60
TimeoutStopSec=30

# Clean up any existing container
ExecStartPre=/bin/bash -c '/usr/bin/podman rm -f $(cat %t/%N.cid) 2>/dev/null || true'

# Start the container and store CID
ExecStart=/usr/bin/podman run \
    --cidfile=%t/%N.cid \
    --name {{ container_name }} \
    --user ${USER_ID}:${GROUP_ID} \
    -p "{{ app_port }}:8080" \
    -p "{{ syslog_port }}:5141" \
    --env-file=/home/{{ solace_local_service_user }}/etc_solace/env \
    -v "{{ host_dir }}:{{ container_path }}:Z,U" \
    {{ container_image }}

# Stop and remove the container using the CID file
ExecStop=/bin/bash -c '/usr/bin/podman stop -t 10 $(cat %t/%N.cid) && /usr/bin/podman rm $(cat %t/%N.cid)'

# Remove the CID file
ExecStopPost=/bin/bash -c 'rm -f %t/%N.cid'

User=solace
Group=solace

[Install]
WantedBy=multi-user.target

