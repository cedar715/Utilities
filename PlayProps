---
- name: Display Podman Container Status and Logs
  hosts: all
  tasks:
    - name: Get the current Podman container status
      command: podman ps --filter "name={{ container_name }}" --format "{{ '{{' }}.ID{{ '}}' }}"
      register: current_container
      become: yes

    - name: Display the current container status
      debug:
        msg: >
          {% if current_container.stdout != "" %}
          Current container ID: {{ current_container.stdout }}
          {% else %}
          No running container found with name {{ container_name }}.
          {% endif %}

    - name: Get the logs of the current running container
      command: podman logs {{ current_container.stdout }}
      when: current_container.stdout != ""
      register: current_logs
      become: yes

    - name: Display the logs of the current container
      debug:
        msg: "{{ current_logs.stdout }}"
      when: current_container.stdout != ""

    - name: Get the previous container logs (if exists)
      command: podman ps -a --filter "name={{ container_name }}" --filter "status=exited" --format "{{ '{{' }}.ID{{ '}}' }}" | head -n 1
      register: previous_container
      become: yes

    - name: Display the previous container ID
      debug:
        msg: >
          {% if previous_container.stdout != "" %}
          Previous container ID: {{ previous_container.stdout }}
          {% else %}
          No previous (exited) container found with name {{ container_name }}.
          {% endif %}

    - name: Get logs of the previous container
      command: podman logs {{ previous_container.stdout }}
      when: previous_container.stdout != ""
      register: previous_logs
      become: yes

    - name: Display the logs of the previous container
      debug:
        msg: "{{ previous_logs.stdout }}"
      when: previous_container.stdout != ""
