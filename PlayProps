---
# site-observability.yaml
- name: Generate certificates for observability components
  hosts: localhost
  gather_facts: false
  
  vars:
    domain_suffix: "example.com"
    # Define VPN configurations that match amqps.vpns structure
    amqps:
      vpns:
        grafana:
          host: "grafana.{{ domain_suffix }}"
        prometheus:
          host: "prometheus.{{ domain_suffix }}"
        jaeger:
          host: "jaeger.{{ domain_suffix }}"
        alertmanager:
          host: "alertmanager.{{ domain_suffix }}"
        node_exporter:
          host: "node-exporter.{{ domain_suffix }}"
    
    # Initialize empty list for generate_hosts as required by the role
    generate_hosts: []

  pre_tasks:
    - name: Display VPN hosts to be generated
      debug:
        msg: "Will generate cert for: {{ amqps.vpns[item].host }}"
      loop: "{{ amqps.vpns.keys() | list }}"
      
    - name: Pause for verification
      pause:
        prompt: "Please verify the hosts above. Press ENTER to continue or Ctrl+C to abort"

  roles:
    - role: certbot-role  # Replace with your actual role name
